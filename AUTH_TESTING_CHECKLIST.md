# 认证功能测试清单

在部署前，请按照此清单测试所有认证功能。

## ✅ 准备工作

- [ ] 已创建 Supabase 项目
- [ ] 已配置 `.env` 文件中的环境变量
- [ ] 已启动开发服务器 (`npm run dev`)
- [ ] 能访问 `http://localhost:3000`

---

## 📝 注册功能测试

### 测试场景 1: 成功注册

- [ ] 访问 `/auth` 页面
- [ ] 点击"注册"标签
- [ ] 填写以下信息：
  - 姓名：`测试用户`
  - 邮箱：`test@example.com`
  - 密码：`Test123456`
  - 确认密码：`Test123456`
- [ ] 点击"注册"按钮
- [ ] 应显示成功提示：`注册成功！请检查您的邮箱以验证账户`
- [ ] 3秒后应自动切换到登录模式
- [ ] 表单应被清空

### 测试场景 2: 密码不匹配

- [ ] 填写注册表单
- [ ] 在"确认密码"中输入不同的密码
- [ ] 点击"注册"
- [ ] 应显示错误提示：`两次输入的密码不一致`

### 测试场景 3: 邮箱已存在

- [ ] 使用已注册的邮箱再次注册
- [ ] 应显示 Supabase 返回的错误信息

### 测试场景 4: 必填字段验证

- [ ] 尝试提交空表单
- [ ] 浏览器应显示 HTML5 验证提示
- [ ] 不应发送请求到 Supabase

---

## 🔐 登录功能测试

### 测试场景 1: 成功登录

- [ ] 访问 `/auth` 页面
- [ ] 确保在"登录"标签
- [ ] 输入注册时的邮箱和密码
- [ ] 点击"登录"按钮
- [ ] 应成功跳转到首页 `/`
- [ ] Header 右上角应显示用户头像图标（不是"登录"文字）

### 测试场景 2: 错误的密码

- [ ] 输入正确的邮箱
- [ ] 输入错误的密码
- [ ] 点击"登录"
- [ ] 应显示错误提示：`登录失败，请检查您的邮箱和密码`

### 测试场景 3: 不存在的邮箱

- [ ] 输入不存在的邮箱
- [ ] 输入任意密码
- [ ] 点击"登录"
- [ ] 应显示错误提示

### 测试场景 4: 加载状态

- [ ] 点击"登录"按钮
- [ ] 在请求期间：
  - [ ] 按钮应显示加载动画和"登录中..."文字
  - [ ] 按钮应变为禁用状态（不可点击）
  - [ ] 页面不应冻结

---

## 🧭 路由保护测试

### 测试场景 1: 未登录访问受保护路由

- [ ] 在浏览器中退出登录（如果已登录）
- [ ] 直接访问以下 URL，应自动重定向到 `/auth`：
  - [ ] `/profile`
  - [ ] `/settings`
  - [ ] `/history`
- [ ] URL 应包含 `redirect` 参数，例如：`/auth?redirect=/profile`

### 测试场景 2: 已登录访问受保护路由

- [ ] 登录后访问：
  - [ ] `/profile` - 应正常显示个人信息页
  - [ ] `/settings` - 应正常显示设置页
  - [ ] `/history` - 应正常显示历史记录页

### 测试场景 3: 已登录访问登录页

- [ ] 登录后访问 `/auth`
- [ ] 应自动重定向到 `/`

---

## 👤 Header 组件测试

### 测试场景 1: 未登录状态

- [ ] 退出登录
- [ ] 查看 Header 右上角
- [ ] 应显示蓝色按钮，文字为"登录"
- [ ] 点击"登录"按钮
- [ ] 应跳转到 `/auth` 页面

### 测试场景 2: 已登录状态

- [ ] 登录后查看 Header
- [ ] 应显示蓝色圆形头像，内含用户图标
- [ ] 点击头像
- [ ] 应显示下拉菜单，包含：
  - [ ] "个人信息"选项
  - [ ] "退出"选项

### 测试场景 3: 用户菜单交互

- [ ] 点击"个人信息"
  - [ ] 应跳转到 `/profile` 页面
  - [ ] 菜单应关闭
- [ ] 再次打开菜单，点击"退出"
  - [ ] 应退出登录
  - [ ] 应跳转到 `/` 首页
  - [ ] Header 应显示"登录"按钮而非头像

### 测试场景 4: 菜单自动关闭

- [ ] 打开用户菜单
- [ ] 点击菜单外的任意位置
- [ ] 菜单应关闭
- [ ] 鼠标移开菜单
- [ ] 菜单应关闭

---

## 🔄 会话持久化测试

### 测试场景 1: 刷新页面

- [ ] 登录后在任意页面
- [ ] 按 F5 刷新页面
- [ ] 应保持登录状态
- [ ] Header 应继续显示用户头像

### 测试场景 2: 打开新标签页

- [ ] 登录后打开新标签页
- [ ] 访问 `http://localhost:3000`
- [ ] 应自动识别为已登录
- [ ] Header 应显示用户头像

### 测试场景 3: 关闭浏览器后重新打开

- [ ] 登录后完全关闭浏览器
- [ ] 重新打开浏览器
- [ ] 访问网站
- [ ] 根据 Supabase 会话设置，可能需要重新登录

---

## 🚪 登出功能测试

### 测试场景 1: 正常登出

- [ ] 登录后点击 Header 头像
- [ ] 点击"退出"
- [ ] 应跳转到首页 `/`
- [ ] Header 应显示"登录"按钮
- [ ] 再次尝试访问 `/profile`
- [ ] 应重定向到 `/auth`

### 测试场景 2: 多标签页登出

- [ ] 在两个标签页中都登录
- [ ] 在标签页 1 中点击退出
- [ ] 切换到标签页 2
- [ ] 刷新页面
- [ ] 标签页 2 也应显示为未登录状态

---

## 📱 响应式测试

### 移动端测试

- [ ] 打开浏览器开发者工具
- [ ] 切换到移动设备视图（iPhone/Android）
- [ ] 测试以下功能：
  - [ ] 登录表单正常显示和操作
  - [ ] 注册表单正常显示和操作
  - [ ] Header 用户菜单正常显示
  - [ ] 所有按钮可点击，大小合适

### 平板测试

- [ ] 切换到平板视图（iPad）
- [ ] 验证所有认证功能正常工作

---

## 🎨 UI/UX 测试

### 表单体验

- [ ] 输入框有适当的 placeholder 文字
- [ ] 输入框有清晰的标签
- [ ] 错误消息清晰易懂，颜色明显（红色背景）
- [ ] 成功消息清晰易懂，颜色明显（绿色背景）
- [ ] 加载状态有明确的视觉反馈
- [ ] 按钮有 hover 效果
- [ ] 表单布局美观，间距合理

### 交互体验

- [ ] 点击"登录"/"注册"标签切换流畅
- [ ] 用户菜单打开/关闭动画流畅
- [ ] 页面跳转无闪烁
- [ ] 没有不必要的页面重新加载

---

## 🐛 错误处理测试

### 网络错误

- [ ] 断开网络连接
- [ ] 尝试登录
- [ ] 应显示友好的错误提示

### Supabase 服务错误

- [ ] 在 `.env` 中故意填写错误的 API key
- [ ] 重启服务器
- [ ] 尝试登录
- [ ] 应显示错误提示（不应崩溃）

### 浏览器兼容性

- [ ] Chrome - 所有功能正常
- [ ] Firefox - 所有功能正常
- [ ] Safari - 所有功能正常
- [ ] Edge - 所有功能正常

---

## 🔐 安全性测试

### XSS 防护

- [ ] 在姓名字段输入 `<script>alert('XSS')</script>`
- [ ] 注册后查看个人信息页
- [ ] 应显示为纯文本，不执行脚本

### SQL 注入防护

- [ ] 在邮箱字段输入 `'; DROP TABLE users; --`
- [ ] 尝试登录
- [ ] 应正常处理（Supabase 自动防护）

### 密码安全

- [ ] 查看浏览器开发者工具 Network 标签
- [ ] 登录时查看请求
- [ ] 密码应被加密传输
- [ ] 不应在 URL 或明文中看到密码

---

## ✅ 最终检查

在标记完成前，确认：

- [ ] 所有测试场景都通过
- [ ] 没有控制台错误
- [ ] 没有 TypeScript 类型错误
- [ ] `.env` 文件未提交到 Git
- [ ] 已阅读 `SUPABASE_SETUP.md` 文档
- [ ] 已阅读 `AUTH_IMPLEMENTATION.md` 文档
- [ ] 准备好部署到生产环境

---

## 📊 测试结果

**测试日期：** _____________

**测试人员：** _____________

**通过数量：** _____ / 总共 _____

**发现的问题：**

1. _______________________________
2. _______________________________
3. _______________________________

**备注：**

_________________________________
_________________________________
_________________________________

---

## 🚀 下一步

测试通过后，可以：

1. 部署到生产环境
2. 配置生产环境的 Supabase 凭证
3. 启用邮箱验证
4. 添加更多功能（如密码重置、社交登录等）
